<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" 1tent="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link rel="stylesheet" href="reset.css"> -->
    <!-- <link rel="stylesheet" href="#"> -->
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      
    </script> 

    <!-- 以下、Firebase -->
        <!-- The core Firebase JS SDK is always required and must be listed first -->
            <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyBSpu4gugaQNUs8E1RfzfEz-H2ZMT3Rfo8",
                authDomain: "php-questionnaire.firebaseapp.com",
                projectId: "php-questionnaire",
                storageBucket: "php-questionnaire.appspot.com",
                messagingSenderId: "536483752965",
                appId: "1:536483752965:web:a689b5d992f0aee456006c"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const ref = firebase.database().ref();
        </script>
</head>



<body>
<!--Div that will hold the pie chart-->
<h1>懇親会アンケート結果</h1>
<h2>参加人数</h2>
<div id="NumberOfParticipants"></div>
<h2>参加者希望</h2>
<select id="date">
    <option value="" selected>日付を選択</option>
    <option value="4月2日">4月2日</option>
    <option value="4月3日">4月3日</option>
    <option value="4月9日">4月9日</option>
    <option value="4月10日">4月10日</option>
    <option value="4月16日">4月16日</option>
    <option value="4月17日">4月17日</option>
</select>
<h3>希望場所</h3>
<div id="place"></div>
<h3>希望料理</h3>
<div id="food"></div>
<div id="allergy"></div>
<div id="chart_div"></div>

<script>
    // Load the Visualization API and the corechart package.
    google.charts.load('current', {'packages':['corechart']});

// 参加人数bar chart
    let apr2 = 0;
    let apr3 = 0;
    let apr9 = 0;
    let apr10 = 0;
    let apr16 = 0;
    let apr17 = 0;
    let people = null;

    // Firebaseから情報を取得
    let peopleData = new Promise((resolve, reject) =>{
            ref.on('child_added',function(data){
                const v = data.val();
                for(let i=0; i<v.date.length; i++){
                    if(v.date[i] == "4月2日"){
                        apr2 ++;
                    } else if(v.date[i] == "4月3日"){
                        apr3 ++;
                    } else if(v.date[i] == "4月9日"){
                        apr9 ++;
                    } else if(v.date[i] == "4月10日"){
                        apr10 ++;
                    } else if(v.date[i] == "4月16日"){
                        apr16 ++;
                    } else if(v.date[i] == "4月17日"){
                        apr17 ++;
                    }
                }
                people = [apr2, apr3, apr9, apr10, apr16, apr17]
                resolve(people);
            })
        }
    )
    
    // Firebaseから情報を取得し終わったら(Promise)、バーチャートを作成する
    peopleData.then((drawParticipantsBarChart) => {
        // Create the data table.
        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.

        var data = google.visualization.arrayToDataTable([
            ['Task', 'Hours per Day'],
            ['4月2日', people[0]],
            ['4月3日', people[1]],
            ['4月9日', people[2]],
            ['4月10日', people[3]],
            ['4月16日', people[4]],
            ['4月17日', people[5]]
        ]);

        // Set chart options
        var options = {'title':'参加人数',
                    'width':400,
                    'height':300};

        // Instantiate and draw our chart, passing in some options.
        var chart = new google.visualization.BarChart(document.getElementById('NumberOfParticipants'));
        chart.draw(data, options);
        
        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawParticipantsBarChart);
       
        });

// 場所の希望
    // 日付ごとの場所配列作成
    let apr2_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let apr3_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let apr9_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let apr10_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let apr16_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let apr17_place = {"新宿":0,"渋谷":0,"恵比寿":0,"新橋":0,"上野":0,"赤羽":0}
    let candidatePlace = null;
      
    // 日付が変わったら、Firebaseから情報を取得
        ref.on('child_added', function(data){
                
                const v = data.val();
                for(let i=0; i<v.date.length; i++){
                    switch(v.date[i]){
                        case "4月2日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr2_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr2_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr2_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr2_place.新橋++;
                                        break;
                                    case "上野":
                                        apr2_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr2_place.赤羽++;
                                }
                            }
                            console.log(apr2_place);
                            break;
                        case "4月3日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr3_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr3_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr3_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr3_place.新橋++;
                                        break;
                                    case "上野":
                                        apr3_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr3_place.赤羽++;
                                        break;
                                }
                            }
                            console.log(apr3_place);
                            break;
                        case "4月9日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr9_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr9_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr9_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr9_place.新橋++;
                                        break;
                                    case "上野":
                                        apr9_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr9_place.赤羽++;
                                        break;
                                }
                            }
                            break;
                        case "4月10日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr10_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr10_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr10_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr10_place.新橋++;
                                        break;
                                    case "上野":
                                        apr10_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr10_place.赤羽++;
                                        break;
                                }
                            }
                            break;
                        case "4月16日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr16_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr16_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr16_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr16_place.新橋++;
                                        break;
                                    case "上野":
                                        apr16_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr16_place.赤羽++;
                                        break;
                                }
                            }
                            break;
                        case "4月17日":
                            for(let j=0; j<v.place.length; j++){
                                switch(v.place[j]){
                                    case "新宿":
                                        apr17_place.新宿++;
                                        break;
                                    case "渋谷":
                                        apr17_place.渋谷++;
                                        break;
                                    case "恵比寿":
                                        apr17_place.恵比寿++;
                                        break;
                                    case "新橋":
                                        apr17_place.新橋++;
                                        break;
                                    case "上野":
                                        apr17_place.上野++;
                                        break;
                                    case "赤羽":
                                        apr17_place.赤羽++;
                                        break;
                                }
                            }
                            break;
                    }
                }
                
            
        })
        
    
            
    // Firebaseから情報を取得し終わったら、円グラフを作成する
    // Firebaseから情報を取得し終わったら、バーチャートを作成する
    $("#date").change(function(){
        console.log(apr2_place);
        d = $("#date").val()
        switch(d){
            case "4月2日":
                candidatePlace = apr2_place
                break;
            case "4月3日":
                candidatePlace = apr3_place
                break;
            case "4月9日":
                candidatePlace = apr9_place
                break;
            case "4月10日":
                candidatePlace = apr10_place
                break;
            case "4月16日":
                candidatePlace = apr16_place
                break;
            case "4月17日":
                candidatePlace = apr17_place
                break;
        }
        console.log(apr2_place);
        console.log(candidatePlace);
        // Create the data table.
        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.

        function drawPlaceColumnChart(){
            var data = google.visualization.arrayToDataTable([
                ['Task', 'Hours per Day'],
                ['新宿', candidatePlace.新宿],
                ['渋谷', candidatePlace.渋谷],
                ['恵比寿', candidatePlace.恵比寿],
                ['新橋', candidatePlace.新橋],
                ['上野', candidatePlace.上野],
                ['赤羽', candidatePlace.赤羽],
            ]);

            // Set chart options
            var options = {'title':'希望場所',
                        'width':400,
                        'height':300};

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(document.getElementById('place'));
            chart.draw(data, options);
        }
        
        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawPlaceColumnChart);
       
        });

// 場所の希望
    // 日付ごとの場所配列作成
    let apr2_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};
    let apr3_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};;
    let apr9_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};;
    let apr10_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};;
    let apr16_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};;
    let apr17_food = {"和食":0,"中華":0,"イタリアン":0,"フレンチ":0};
    let candidateFood = null;
      
    // 日付が変わったら、Firebaseから情報を取得
        ref.on('child_added', function(data){
                
                const v = data.val();
                for(let i=0; i<v.date.length; i++){
                    switch(v.date[i]){
                        case "4月2日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr2_food.和食++;
                                        break;
                                    case "中華":
                                        apr2_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr2_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr2_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr2_food);
                            break;
                        case "4月3日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr3_food.和食++;
                                        break;
                                    case "中華":
                                        apr3_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr3_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr3_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr3_food);
                            break;
                        case "4月9日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr9_food.和食++;
                                        break;
                                    case "中華":
                                        apr9_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr9_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr9_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr9_food);
                            break;
                        case "4月10日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr10_food.和食++;
                                        break;
                                    case "中華":
                                        apr10_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr10_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr10_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr10_food);
                            break;
                        case "4月16日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr16_food.和食++;
                                        break;
                                    case "中華":
                                        apr16_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr16_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr16_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr16_food);
                            break;
                        case "4月17日":
                            for(let j=0; j<v.food.length; j++){
                                switch(v.food[j]){
                                    case "和食":
                                        apr17_food.和食++;
                                        break;
                                    case "中華":
                                        apr17_food.中華++;
                                        break;
                                    case "イタリアン":
                                        apr17_food.イタリアン++;
                                        break;
                                    case "フレンチ":
                                        apr17_food.フレンチ++;
                                        break;
                                }
                            }
                            console.log(apr17_food);
                            break;
                    }
                }
                
            
        })
        
    
            
    // Firebaseから情報を取得し終わったら、円グラフを作成する
    // Firebaseから情報を取得し終わったら、バーチャートを作成する
    $("#date").change(function(){
        console.log(apr2_food);
        d = $("#date").val()
        switch(d){
            case "4月2日":
                candidateFood = apr2_food;
                break;
            case "4月3日":
                candidateFood = apr3_food;
                break;
            case "4月9日":
                candidateFood = apr9_food;
                break;
            case "4月10日":
                candidateFood = apr10_food;
                break;
            case "4月16日":
                candidateFood = apr16_food;
                break;
            case "4月17日":
                candidateFood = apr17_food;
                break;
        }
        console.log(apr2_food);
        console.log(candidateFood);
        // Create the data table.
        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.

        function drawFoodColumnChart() {
            var data = google.visualization.arrayToDataTable([
                ['Task', 'Hours per Day'],
                ['和食', candidateFood.和食],
                ['中華', candidateFood.中華],
                ['イタリアン', candidateFood.イタリアン],
                ['フレンチ', candidateFood.フレンチ]
            ]);

            // Set chart options
            var options = {'title':'希望料理',
                        'width':400,
                        'height':300};

            // Instantiate and draw our chart, passing in some options.
            var chart = new google.visualization.ColumnChart(document.getElementById('food'));
            chart.draw(data, options);
        }
        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawFoodColumnChart);
       
        });
    

    
</script>



</body>

</html>